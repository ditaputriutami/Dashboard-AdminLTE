# ğŸ“Š DIAGRAM VISUAL - SISTEM SIMPAN/CETAK

## ğŸ—ºï¸ ARSITEKTUR SISTEM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER INTERFACE                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Detail Jual Page (detail_jual.blade.php)             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Input   â”‚  â”‚  Table   â”‚  â”‚  Tombol            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Barang  â”‚  â”‚  Daftar  â”‚  â”‚  Simpan/Cetak â­   â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ AJAX POST
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Route: /jual/simpan (web.php)                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                   â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Controller: JualController::simpan()                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  1. DB::beginTransaction()                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  2. Validasi Input                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  3. Loop Setiap Barang:                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚     â”œâ”€ Cek stok mencukupi                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚     â”œâ”€ Insert detail_jual                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚     â”œâ”€ UPDATE barang SET stok = stok - qty â­    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚     â””â”€ Hitung total                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  4. Update jumlah_pembelian                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  5. DB::commit()                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  6. Return JSON response                         â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ JSON Response
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATABASE                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  barang    â”‚  â”‚    jual    â”‚  â”‚    detail_jual       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ stok â”‚â¬‡ â”‚  â”‚  â”‚total â”‚â¬† â”‚  â”‚  â”‚ jual_id        â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚ barang_id      â”‚ â”‚  â”‚
â”‚  â”‚  (dikurangi)â”‚  â”‚  (diupdate)â”‚  â”‚  â”‚ qty            â”‚ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ harga_sekarang â”‚ â”‚  â”‚
â”‚                                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ Redirect URL
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CETAK STRUK                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Cetak Page (cetak.blade.php)                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  ğŸª TOKO SERBA ADA                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  No: 160 | Tgl: 23-12-2025                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Pelanggan: Dita Putri Utami                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Lampu LED 10W  | 1 Pcs  | Rp 75,000           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  TOTAL: Rp 75,000                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  [ğŸ–¨ï¸ Cetak] [ğŸ  Kembali]                        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ FLOW DIAGRAM TRANSAKSI

```
START
  â”‚
  â”œâ”€â–º User akses /jual/create
  â”‚     â”‚
  â”‚     â”œâ”€â–º Input pelanggan
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â–º POST /jual/store
  â”‚     â”‚           â”‚
  â”‚     â”‚           â””â”€â–º Redirect ke /detailJual/{id}
  â”‚     â”‚
  â”‚     â–¼
  â”œâ”€â–º User tambah barang
  â”‚     â”‚
  â”‚     â”œâ”€â–º Ketik kode barang
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â–º AJAX /bacaBarang
  â”‚     â”‚           â”‚
  â”‚     â”‚           â””â”€â–º Return data barang
  â”‚     â”‚
  â”‚     â”œâ”€â–º Input qty
  â”‚     â”‚
  â”‚     â”œâ”€â–º Klik "Tambah"
  â”‚     â”‚     â”‚
  â”‚     â”‚     â””â”€â–º Data masuk tabel (client-side)
  â”‚     â”‚
  â”‚     â””â”€â–º Ulangi untuk barang lain
  â”‚
  â–¼
Klik "Simpan/Cetak" â­
  â”‚
  â”œâ”€â–º JavaScript ambil data
  â”‚     â”‚
  â”‚     â””â”€â–º Array dataBarang = [
  â”‚           {barang_id, qty, harga_sekarang},
  â”‚           {barang_id, qty, harga_sekarang},
  â”‚           ...
  â”‚         ]
  â”‚
  â”œâ”€â–º Validasi
  â”‚     â”‚
  â”‚     â”œâ”€â–º Cek length > 0?
  â”‚     â”‚     â”œâ”€â–º NO â”€â”€â–º Alert "Keranjang kosong"
  â”‚     â”‚     â””â”€â–º YES â”€â”€â–º Continue
  â”‚     â”‚
  â”‚     â””â”€â–º Konfirmasi user?
  â”‚           â”œâ”€â–º NO â”€â”€â–º Cancel
  â”‚           â””â”€â–º YES â”€â”€â–º Continue
  â”‚
  â”œâ”€â–º AJAX POST /jual/simpan
  â”‚     â”‚
  â”‚     â””â”€â–º Data: {
  â”‚           _token,
  â”‚           idJual,
  â”‚           dataBarang: [...]
  â”‚         }
  â”‚
  â–¼
BACKEND PROCESSING
  â”‚
  â”œâ”€â–º DB::beginTransaction() ğŸ”’
  â”‚     â”‚
  â”‚     â”œâ”€â–º Loop foreach dataBarang:
  â”‚     â”‚     â”‚
  â”‚     â”‚     â”œâ”€â–º Barang::find(barang_id)
  â”‚     â”‚     â”‚     â”‚
  â”‚     â”‚     â”‚     â””â”€â–º Found?
  â”‚     â”‚     â”‚           â”œâ”€â–º NO â”€â”€â–º throw Exception â”€â”€â”
  â”‚     â”‚     â”‚           â””â”€â–º YES â”€â”€â–º Continue         â”‚
  â”‚     â”‚     â”‚                                         â”‚
  â”‚     â”‚     â”œâ”€â–º Cek stok >= qty?                     â”‚
  â”‚     â”‚     â”‚     â”œâ”€â–º NO â”€â”€â–º throw Exception â”€â”€â”     â”‚
  â”‚     â”‚     â”‚     â””â”€â–º YES â”€â”€â–º Continue          â”‚     â”‚
  â”‚     â”‚     â”‚                                    â”‚     â”‚
  â”‚     â”‚     â”œâ”€â–º Insert detail_jual âœ…            â”‚     â”‚
  â”‚     â”‚     â”‚                                    â”‚     â”‚
  â”‚     â”‚     â”œâ”€â–º UPDATE barang â­                 â”‚     â”‚
  â”‚     â”‚     â”‚   SET stok = stok - qty           â”‚     â”‚
  â”‚     â”‚     â”‚                                    â”‚     â”‚
  â”‚     â”‚     â””â”€â–º total += qty * harga            â”‚     â”‚
  â”‚     â”‚                                          â”‚     â”‚
  â”‚     â”œâ”€â–º Update jual.jumlah_pembelian          â”‚     â”‚
  â”‚     â”‚                                          â”‚     â”‚
  â”‚     â””â”€â–º DB::commit() âœ…                        â”‚     â”‚
  â”‚           â”‚                                    â”‚     â”‚
  â”‚           â””â”€â–º Return JSON:                     â”‚     â”‚
  â”‚               {berhasil: true, urlCetak}       â”‚     â”‚
  â”‚                                                â”‚     â”‚
  â”‚     [ERROR HANDLING] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜     â”‚
  â”‚           â”‚                                  â”‚       â”‚
  â”‚           â”œâ”€â–º catch Exception:               â”‚       â”‚
  â”‚           â”‚     â”‚                            â”‚       â”‚
  â”‚           â”‚     â”œâ”€â–º DB::rollback() âŒ â—„â”€â”€â”€â”€â”€â”€â”˜       â”‚
  â”‚           â”‚     â”‚                                    â”‚
  â”‚           â”‚     â””â”€â–º Return JSON:                     â”‚
  â”‚           â”‚         {berhasil: false, message}       â”‚
  â”‚           â”‚                                          â”‚
  â”‚           â””â”€â–º catch Throwable: â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                 â”‚
  â”‚                 â””â”€â–º DB::rollback() âŒ
  â”‚                     Return JSON error
  â”‚
  â–¼
FRONTEND RESPONSE
  â”‚
  â”œâ”€â–º Success?
  â”‚     â”œâ”€â–º YES:
  â”‚     â”‚     â”œâ”€â–º Alert "Berhasil!"
  â”‚     â”‚     â””â”€â–º Redirect ke urlCetak
  â”‚     â”‚           â”‚
  â”‚     â”‚           â””â”€â–º /jual/cetak/{id}
  â”‚     â”‚
  â”‚     â””â”€â–º NO:
  â”‚           â”œâ”€â–º Alert error message
  â”‚           â””â”€â–º Re-enable tombol
  â”‚
  â–¼
HALAMAN CETAK
  â”‚
  â”œâ”€â–º Tampilkan struk
  â”‚     â”‚
  â”‚     â”œâ”€â–º Header toko
  â”‚     â”œâ”€â–º Info transaksi
  â”‚     â”œâ”€â–º Tabel barang
  â”‚     â”œâ”€â–º Total
  â”‚     â””â”€â–º Tombol cetak & kembali
  â”‚
  â””â”€â–º User klik "Cetak Struk"
        â”‚
        â””â”€â–º window.print()
              â”‚
              â””â”€â–º Print Dialog
                    â”‚
                    â””â”€â–º Cetak fisik âœ…

END
```

---

## ğŸ” SECURITY FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client Request                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  POST /jual/simpan                 â”‚ â”‚
â”‚  â”‚  Headers:                          â”‚ â”‚
â”‚  â”‚    X-CSRF-TOKEN: xxxxx â­          â”‚ â”‚
â”‚  â”‚  Body:                             â”‚ â”‚
â”‚  â”‚    dataBarang: [...]               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Middleware Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. CSRF Verification âœ…           â”‚ â”‚
â”‚  â”‚  2. Authentication Check âœ…        â”‚ â”‚
â”‚  â”‚  3. Authorization âœ…               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Passed
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Controller Validation                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. Input Validation               â”‚ â”‚
â”‚  â”‚     â”œâ”€ dataBarang exists?          â”‚ â”‚
â”‚  â”‚     â”œâ”€ qty is integer?             â”‚ â”‚
â”‚  â”‚     â””â”€ barang_id exists?           â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚  2. Business Logic Validation      â”‚ â”‚
â”‚  â”‚     â”œâ”€ Barang exists in DB?        â”‚ â”‚
â”‚  â”‚     â””â”€ Stok >= qty? â­             â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚  3. Security Measures              â”‚ â”‚
â”‚  â”‚     â”œâ”€ Harga from DB, not input âœ… â”‚ â”‚
â”‚  â”‚     â”œâ”€ SQL Injection prevention âœ… â”‚ â”‚
â”‚  â”‚     â””â”€ Parameter binding âœ…        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Valid
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database Transaction                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  BEGIN TRANSACTION                 â”‚ â”‚
â”‚  â”‚    â”œâ”€ Insert detail_jual           â”‚ â”‚
â”‚  â”‚    â”œâ”€ Update stok                  â”‚ â”‚
â”‚  â”‚    â””â”€ Update total                 â”‚ â”‚
â”‚  â”‚  COMMIT âœ…                          â”‚ â”‚
â”‚  â”‚  or                                â”‚ â”‚
â”‚  â”‚  ROLLBACK âŒ (if error)            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Success:                          â”‚ â”‚
â”‚  â”‚    {berhasil: true, urlCetak}      â”‚ â”‚
â”‚  â”‚  Error:                            â”‚ â”‚
â”‚  â”‚    {berhasil: false, message}      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š DATABASE RELATIONSHIP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       pelanggan          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ id (PK)              â”‚ â”‚
â”‚ â”‚ nama_pelanggan       â”‚ â”‚
â”‚ â”‚ alamat               â”‚ â”‚
â”‚ â”‚ telp_hp              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ 1
            â”‚
            â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         jual             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ id (PK)              â”‚ â”‚       â”‚       users          â”‚
â”‚ â”‚ tanggal              â”‚ â”‚       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ pelanggan_id (FK) â”€â”€â”€â”¼â”€â”˜       â”‚ â”‚ id (PK)          â”‚ â”‚
â”‚ â”‚ user_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–º â”‚                â”‚ â”‚
â”‚ â”‚ jumlah_pembelian â­  â”‚         â”‚ â”‚ name             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ 1
            â”‚
            â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      detail_jual         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ id (PK)              â”‚ â”‚
â”‚ â”‚ jual_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”˜
â”‚ â”‚ barang_id (FK) â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”
â”‚ â”‚ qty â­               â”‚   â”‚
â”‚ â”‚ harga_sekarang       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ N
                              â”‚
                              â”‚ 1
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚       barang           â”‚
                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚ â”‚ id (PK)              â”‚ â”‚
                    â”‚ â”‚ nama_barang          â”‚ â”‚
                    â”‚ â”‚ harga_jual           â”‚ â”‚
                    â”‚ â”‚ satuan               â”‚ â”‚
                    â”‚ â”‚ stok â­              â”‚ â”‚
                    â”‚ â”‚   (dikurangi otomatis)â”‚ â”‚
                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ TRANSACTION TIMELINE

```
TIME    â”‚ ACTION                          â”‚ DATABASE STATUS
â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
T0      â”‚ BEGIN TRANSACTION               â”‚ ğŸ”’ Lock acquired
        â”‚                                 â”‚
T1      â”‚ SELECT * FROM barang WHERE...   â”‚ âœ… Barang ID=1 found
        â”‚                                 â”‚    stok = 100
        â”‚                                 â”‚
T2      â”‚ Check: stok(100) >= qty(10)?   â”‚ âœ… Valid
        â”‚                                 â”‚
T3      â”‚ INSERT INTO detail_jual...      â”‚ âœ… Row inserted
        â”‚                                 â”‚
T4      â”‚ UPDATE barang SET stok=stok-10  â”‚ â³ Pending...
        â”‚ WHERE id=1                      â”‚    stok = 100 â†’ 90
        â”‚                                 â”‚
T5      â”‚ UPDATE jual SET total=75000     â”‚ â³ Pending...
        â”‚                                 â”‚
T6      â”‚ COMMIT âœ…                        â”‚ ğŸ’¾ SAVED!
        â”‚                                 â”‚    stok = 90 (permanent)
        â”‚                                 â”‚ ğŸ”“ Lock released
â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ALTERNATIVE (ERROR):

TIME    â”‚ ACTION                          â”‚ DATABASE STATUS
â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
T0      â”‚ BEGIN TRANSACTION               â”‚ ğŸ”’ Lock acquired
T1      â”‚ INSERT detail_jual...           â”‚ âœ… Row inserted (temp)
T2      â”‚ UPDATE barang stok...           â”‚ âœ… Updated (temp)
        â”‚                                 â”‚    stok = 100 â†’ 90
T3      â”‚ âŒ ERROR: Connection lost       â”‚ âš ï¸ Transaction pending
        â”‚                                 â”‚
T4      â”‚ ROLLBACK âŒ                      â”‚ â†©ï¸ UNDO ALL!
        â”‚                                 â”‚    stok = 90 â†’ 100 (restored)
        â”‚                                 â”‚ ğŸ”“ Lock released
â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¼â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## ğŸ¯ USE CASE DIAGRAM

```
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚    Kasir    â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        â”‚           â”‚
        â–¼           â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Buat    â”‚ â”‚ Simpan/Cetak â”‚ â­
  â”‚Transaksiâ”‚ â”‚  Transaksi   â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚             â”‚
       â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚     â”‚                â”‚
       â”‚     â–¼                â–¼
       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ â”‚ Validasiâ”‚   â”‚ Kurangi  â”‚
       â”‚ â”‚  Stok   â”‚   â”‚  Stok â­ â”‚
       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚
       â”‚                     â–¼
       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚  Simpan ke  â”‚
       â”‚              â”‚  Database   â”‚
       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â–º
                             â”‚
                             â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚Cetak Struk  â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Diagram ini menunjukkan alur lengkap sistem dari UI sampai database!** ğŸ“Š
